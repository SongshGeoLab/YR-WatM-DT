# å¤šæƒ…æ™¯é›†æˆæµ‹è¯•æŒ‡å—

## ğŸ¯ æµ‹è¯•ç›®æ ‡

éªŒè¯å‰ç«¯ `ScenarioContext` èƒ½å¦æ­£ç¡®ä½¿ç”¨æ–°çš„ `/series/multi` APIï¼Œå¹¶åœ¨æµè§ˆå™¨ä¸­å±•ç¤ºå¤šæƒ…æ™¯æ•°æ®ã€‚

## ğŸš€ å¯åŠ¨æœåŠ¡

```bash
# ç¡®ä¿æœåŠ¡æ­£åœ¨è¿è¡Œ
make dev

# æˆ–è€…æ£€æŸ¥æœåŠ¡çŠ¶æ€
curl http://127.0.0.1:8000/
```

## ğŸ“‹ æµ‹è¯•æ­¥éª¤

### 1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·

1. è®¿é—® http://localhost:3000
2. æŒ‰ `F12` æ‰“å¼€å¼€å‘è€…å·¥å…·
3. åˆ‡æ¢åˆ° **Console** æ ‡ç­¾é¡µ

### 2. æµ‹è¯•å•æƒ…æ™¯æ¨¡å¼

**æ“ä½œ**ï¼š
1. åœ¨ Global Parameter Panel ä¸­è®¾ç½®æ‰€æœ‰å‚æ•°ä¸ºå…·ä½“å€¼
   - Climate: RCP4.5
   - Fertility: 1.7
   - Diet: Moderate
   - Ecological Flow: 0.25
   - Irrigation: 0.85
   - Fire Generation: 0.15

**é¢„æœŸæ—¥å¿—**ï¼š
```
ğŸ”§ Updating parameter: climateScenario = 2
ğŸ” Resolving scenarios with parameters: {...}
âœ… Single scenario resolved: sc_xxx
ğŸ“Š Fetching [å˜é‡å] for single scenario sc_xxx...
âœ… Loaded [å˜é‡å]: 81 data points
```

**éªŒè¯**ï¼š
- âœ… æ˜¾ç¤º "Current Scenario: sc_xxx" (ç»¿è‰²æ ‡ç­¾)
- âœ… å›¾è¡¨æ­£å¸¸æ˜¾ç¤ºå•æ¡æ›²çº¿
- âœ… æ²¡æœ‰ç½®ä¿¡åŒºé—´é˜´å½±

---

### 3. æµ‹è¯•å¤šæƒ…æ™¯æ¨¡å¼ï¼ˆå•å‚æ•° Anyï¼‰

**æ“ä½œ**ï¼š
1. ä¿æŒå…¶ä»–å‚æ•°ä¸å˜
2. ç‚¹å‡» Climate çš„ "Clear" æŒ‰é’®ï¼Œè®¾ç½®ä¸º nullï¼ˆAnyï¼‰

**é¢„æœŸæ—¥å¿—**ï¼š
```
ğŸ”§ Updating parameter: climateScenario = null
ğŸ“Š Some parameters are null, staying in multiple scenarios mode
ğŸ“Š Estimated scenario count: 3
ğŸ“Š Fetching [å˜é‡å] for multiple scenarios using /series/multi API...
ğŸ” Querying with filters: {
  "Fertility Variation": 1.7,
  "Diet change scenario switch": 2,
  ...
}
ğŸ“Š Expected to match ~3 scenarios
âœ… Loaded [å˜é‡å] with real multi-scenario data:
   - 3 scenarios matched
   - 81 time points
   - Mean range: 100.00 - 150.00
```

**éªŒè¯**ï¼š
- âœ… æ˜¾ç¤º "Current Scenario: Multiple (3)" (æ©™è‰²æ ‡ç­¾)
- âœ… å›¾è¡¨æ˜¾ç¤ºå‡å€¼æ›²çº¿ + ç½®ä¿¡åŒºé—´é˜´å½±
- âœ… æ•°æ®æ˜¯çœŸå®çš„å¤šæƒ…æ™¯èšåˆç»“æœ

---

### 4. æµ‹è¯•å¤šæƒ…æ™¯æ¨¡å¼ï¼ˆå¤šå‚æ•° Anyï¼‰

**æ“ä½œ**ï¼š
1. ç»§ç»­ç‚¹å‡»å…¶ä»–å‚æ•°çš„ "Clear" æŒ‰é’®
2. ä¾‹å¦‚ï¼šClimate = Any, Fertility = Any

**é¢„æœŸæ—¥å¿—**ï¼š
```
ğŸ“Š Estimated scenario count: 15
ğŸ“Š Fetching [å˜é‡å] for multiple scenarios using /series/multi API...
âœ… Loaded [å˜é‡å] with real multi-scenario data:
   - 15 scenarios matched
   - 81 time points
   - Mean range: 95.00 - 155.00
```

**éªŒè¯**ï¼š
- âœ… æ˜¾ç¤º "Current Scenario: Multiple (15)" (æ©™è‰²æ ‡ç­¾)
- âœ… ç½®ä¿¡åŒºé—´æ›´å®½ï¼ˆå› ä¸ºå˜å¼‚æ€§æ›´å¤§ï¼‰
- âœ… æ•°æ®å®æ—¶ä»åç«¯è·å–

---

### 5. å‹åŠ›æµ‹è¯•ï¼ˆå¤§é‡æƒ…æ™¯ï¼‰

**æ“ä½œ**ï¼š
1. åªè®¾ç½® 1-2 ä¸ªå‚æ•°ï¼Œå…¶ä»–å…¨éƒ¨è®¾ä¸º Any
2. è§‚å¯Ÿæ€§èƒ½å’Œå“åº”æ—¶é—´

**é¢„æœŸè¡Œä¸º**ï¼š
- æ—¥å¿—æ˜¾ç¤ºåŒ¹é…äº†å¤§é‡æƒ…æ™¯ï¼ˆå¯èƒ½ä¸Šåƒä¸ªï¼‰
- å“åº”æ—¶é—´ < 3ç§’
- æµè§ˆå™¨ä¸å¡é¡¿
- å›¾è¡¨æµç•…æ¸²æŸ“

---

## ğŸ” å…³é”®æ—¥å¿—è§£è¯»

### æˆåŠŸæ—¥å¿—ç¤ºä¾‹
```javascript
// 1. å‚æ•°æ›´æ–°
ğŸ”§ Updating parameter: climateScenario = null

// 2. æƒ…æ™¯è§£æ
ğŸ“Š Some parameters are null, staying in multiple scenarios mode
ğŸ“Š Estimated scenario count: 27

// 3. API è°ƒç”¨
ğŸ“Š Fetching Total population for multiple scenarios using /series/multi API...
ğŸ” Querying with filters: {"Fertility Variation":1.7,"Diet change scenario switch":2}

// 4. æˆåŠŸå“åº”
âœ… Loaded Total population with real multi-scenario data:
   - 27 scenarios matched
   - 81 time points
   - Mean range: 42500.00 - 68200.00
```

### é”™è¯¯æ—¥å¿—ç¤ºä¾‹ï¼ˆåº”è¯¥é¿å…ï¼‰
```javascript
âŒ Failed to fetch multi-scenario data: [é”™è¯¯ä¿¡æ¯]
âš ï¸ Using fallback demo data due to error: [é”™è¯¯ä¿¡æ¯]
```

å¦‚æœçœ‹åˆ°é”™è¯¯ï¼š
1. æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œï¼š`curl http://127.0.0.1:8000/params`
2. æ£€æŸ¥ CORS è®¾ç½®
3. æŸ¥çœ‹åç«¯æ—¥å¿—

---

## ğŸ“Š UI éªŒè¯æ¸…å•

### Parameter Panel çŠ¶æ€æ˜¾ç¤º

- [ ] **Single Scenario**
  ```
  Current Scenario: sc_42 (ç»¿è‰²æ ‡ç­¾)
  ```

- [ ] **Multiple Scenarios**
  ```
  Current Scenario: Multiple (27) (æ©™è‰²æ ‡ç­¾)
  ```

- [ ] **Loading State**
  ```
  Updating... (é»„è‰²åŠ¨ç”»)
  ```

### å›¾è¡¨æ¸²æŸ“

- [ ] **å•æƒ…æ™¯**: å•æ¡å®çº¿ï¼Œæ— é˜´å½±
- [ ] **å¤šæƒ…æ™¯**: å‡å€¼æ›²çº¿ + ç½®ä¿¡åŒºé—´é˜´å½±ï¼ˆæµ…è‰²ï¼‰
- [ ] **ç½®ä¿¡åŒºé—´**: CI ä¸Šä¸‹ç•Œåº”è¯¥å¯¹ç§°
- [ ] **å“åº”å¼**: å‚æ•°å˜åŒ–æ—¶å›¾è¡¨è‡ªåŠ¨æ›´æ–°

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: æ˜¾ç¤º "Using fallback demo data"

**åŸå› **: API è°ƒç”¨å¤±è´¥

**æ’æŸ¥**:
```bash
# æµ‹è¯• API æ˜¯å¦æ­£å¸¸
curl "http://127.0.0.1:8000/series/multi?variable=Total%20population&filters=%7B%7D&aggregate=true"
```

**è§£å†³**:
- ç¡®ä¿åç«¯æœåŠ¡è¿è¡Œåœ¨ 8000 ç«¯å£
- æ£€æŸ¥ `viz/.env` ä¸­çš„ `VITE_API_URL`

---

### é—®é¢˜ 2: å›¾è¡¨ä¸æ›´æ–°

**åŸå› **: React çŠ¶æ€æ›´æ–°é—®é¢˜

**æ’æŸ¥**:
- æ‰“å¼€ React DevTools
- æ£€æŸ¥ `ScenarioContext` çš„ `parameters` çŠ¶æ€
- æŸ¥çœ‹ `scenarioResult` æ˜¯å¦æ­£ç¡®

**è§£å†³**:
- åˆ·æ–°é¡µé¢
- æ£€æŸ¥æ˜¯å¦æœ‰ JavaScript é”™è¯¯

---

### é—®é¢˜ 3: æƒ…æ™¯æ•°é‡ä¸ç¬¦åˆé¢„æœŸ

**åŸå› **: æ•°æ®åº“ä¸­çš„æƒ…æ™¯ç»„åˆæ•°é‡

**éªŒè¯**:
```bash
# æ£€æŸ¥å‚æ•°ç»„åˆ
curl http://127.0.0.1:8000/params
```

**è¯´æ˜**:
- ä¸æ˜¯æ‰€æœ‰å‚æ•°ç»„åˆéƒ½å­˜åœ¨å¯¹åº”æƒ…æ™¯
- æŸäº›å‚æ•°ç»„åˆå¯èƒ½æ²¡æœ‰æ•°æ®

---

## âœ… æˆåŠŸæ ‡å‡†

å…¨éƒ¨é€šè¿‡ä»¥ä¸‹æ£€æŸ¥ï¼š

1. âœ… å•æƒ…æ™¯æ¨¡å¼æ­£å¸¸å·¥ä½œ
2. âœ… å¤šæƒ…æ™¯æ¨¡å¼ä½¿ç”¨çœŸå® APIï¼ˆä¸æ˜¯ demo æ•°æ®ï¼‰
3. âœ… å‚æ•° Any é€»è¾‘æ­£ç¡®ï¼ˆnull å‚æ•°ä¸ä¼ ç»™åç«¯ï¼‰
4. âœ… å›¾è¡¨æ˜¾ç¤ºç½®ä¿¡åŒºé—´
5. âœ… æ—¥å¿—æ¸…æ™°æ˜¾ç¤ºåŒ¹é…æƒ…æ™¯æ•°é‡
6. âœ… æ€§èƒ½è‰¯å¥½ï¼ˆ< 3ç§’å“åº”ï¼‰
7. âœ… æ—  JavaScript é”™è¯¯

---

## ğŸ“¸ æœŸæœ›æ•ˆæœæˆªå›¾è¯´æ˜

### å•æƒ…æ™¯æ¨¡å¼
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Current Scenario: sc_42  [ç»¿è‰²]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚     å›¾è¡¨ï¼šå•æ¡å®çº¿                    â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¤šæƒ…æ™¯æ¨¡å¼
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Current Scenario: Multiple (27) [æ©™]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚     å›¾è¡¨ï¼šå‡å€¼æ›²çº¿ + ç½®ä¿¡åŒºé—´é˜´å½±      â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”‚
â”‚     â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ (CI)             â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ‰ æµ‹è¯•å®Œæˆ

å¦‚æœæ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Œæ­å–œï¼ä½ çš„å¤šæƒ…æ™¯é›†æˆå·²ç»æˆåŠŸï¼

ç°åœ¨å¯ä»¥ï¼š
1. åœ¨å®é™…åœºæ™¯ä¸­ä½¿ç”¨ Global Parameter Panel
2. å°è¯•ä¸åŒçš„å‚æ•°ç»„åˆ
3. è§‚å¯ŸçœŸå®çš„å¤šæƒ…æ™¯èšåˆæ•°æ®
4. äº«å—æµç•…çš„ "Any" å‚æ•°ä½“éªŒï¼

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æ›´æ–°æ—¥æœŸ**: 2025-10-18
